<!-- gerenciar-tenis.component.html -->
<div class="admin-container">
  <!-- Header modernizado -->
  <div class="admin-header">
    <h1>Painel Administrativo</h1>
    <p>Cadastre, edite e gerencie os produtos da loja</p>
  </div>

  <!-- Dica sobre IDs redesenhada -->
  <div class="form-info">
    <p><strong>ðŸ’¡ Dica:</strong> Use IDs 1 para teste (Marca: 1, Modelo: 1, Esporte: 1, Cor: 1)</p>
    <button type="button" (click)="irParaGerenciamentoGeral()" class="btn-info">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 16v-4m0-4h.01"/>
      </svg>
      Ver IDs no Gerenciamento Geral
    </button>
  </div>

  <!-- FormulÃ¡rio de Cadastro/EdiÃ§Ã£o redesenhado -->
  <div class="form-section">
    <h2>{{ editMode ? 'Editar TÃªnis' : 'Cadastrar Novo TÃªnis' }}</h2>
    
    <form [formGroup]="tenisForm" (ngSubmit)="onSubmit()" class="tenis-form">
      <div class="form-row">
        <div class="form-group">
          <label for="nome">Nome do TÃªnis *</label>
          <input type="text" id="nome" formControlName="nome" class="form-control" placeholder="Digite o nome do tÃªnis">
          <div *ngIf="nome?.invalid && nome?.touched" class="error-message">
            <span *ngIf="nome?.errors?.['required']">Nome Ã© obrigatÃ³rio</span>
            <span *ngIf="nome?.errors?.['minlength']">MÃ­nimo 3 caracteres</span>
          </div>
        </div>

        <div class="form-group">
          <label for="preco">PreÃ§o (R$) *</label>
          <input type="number" id="preco" formControlName="preco" step="0.01" min="0" class="form-control" placeholder="0.00">
          <div *ngIf="preco?.invalid && preco?.touched" class="error-message">
            <span *ngIf="preco?.errors?.['required']">PreÃ§o Ã© obrigatÃ³rio</span>
            <span *ngIf="preco?.errors?.['min']">PreÃ§o deve ser maior que zero</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="descricao">DescriÃ§Ã£o *</label>
        <textarea id="descricao" formControlName="descricao" rows="3" class="form-control" placeholder="Descreva as caracterÃ­sticas do tÃªnis"></textarea>
        <div *ngIf="descricao?.invalid && descricao?.touched" class="error-message">
          <span *ngIf="descricao?.errors?.['required']">DescriÃ§Ã£o Ã© obrigatÃ³ria</span>
          <span *ngIf="descricao?.errors?.['minlength']">MÃ­nimo 10 caracteres</span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="genero">GÃªnero *</label>
          <select id="genero" formControlName="genero" class="form-control">
            <option value="MASCULINO">Masculino</option>
            <option value="FEMININO">Feminino</option>
            <option value="UNISSEX">Unissex</option>
          </select>
        </div>

        <div class="form-group">
          <label for="material">Material *</label>
          <input type="text" id="material" formControlName="material" class="form-control" placeholder="Ex: Couro, SintÃ©tico, Mesh">
          <div *ngIf="material?.invalid && material?.touched" class="error-message">
            <span *ngIf="material?.errors?.['required']">Material Ã© obrigatÃ³rio</span>
            <span *ngIf="material?.errors?.['minlength']">MÃ­nimo 3 caracteres</span>
          </div>
        </div>
      </div>

      <!-- SEÃ‡ÃƒO: UPLOAD DE MÃšLTIPLAS IMAGENS -->
      <div class="form-group">
        <label for="imagens">Imagens do TÃªnis</label>
        <div class="upload-container">
          <div class="upload-area" (click)="fileInput.click()" [class.has-images]="imagensPreviews.length > 0">
            <input #fileInput type="file" (change)="onFilesSelected($event)" accept="image/*" multiple class="file-input" hidden>
            
            <div *ngIf="imagensPreviews.length === 0" class="upload-placeholder">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              <p>Clique para fazer upload das imagens</p>
              <small>Formatos: JPG, PNG, WebP (MÃ¡x: 10MB cada)</small>
              <small>Selecione mÃºltiplas imagens</small>
            </div>

            <div *ngIf="imagensPreviews.length > 0" class="images-preview-container">
              <div class="images-grid">
                <div *ngFor="let preview of imagensPreviews; let i = index" class="image-preview-item">
                  <img [src]="preview.url" [alt]="'Preview ' + (i + 1)" class="preview-image">
                  <div class="image-actions">
                    <button type="button" (click)="removerPreview(i)" class="btn-remove-preview">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                      </svg>
                    </button>
                  </div>
                  <div class="image-name">{{ preview.file.name }}</div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="imagensExistentes.length > 0" class="existing-images">
            <h4>Imagens Existentes</h4>
            <div class="existing-images-grid">
              <div *ngFor="let imagem of imagensExistentes; let i = index" class="existing-image-item">
                <img [src]="imagem" [alt]="'Imagem ' + (i + 1)" class="existing-image">
                <div class="existing-image-actions">
                  <button type="button" (click)="removerImagemExistente(imagem)" class="btn-remove-existing">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="uploadProgress > 0" class="upload-progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="uploadProgress"></div>
            </div>
            <span class="progress-text">{{ uploadProgress }}%</span>
          </div>
        </div>
      </div>

      <!-- SEÃ‡ÃƒO: TAMANHOS DISPONÃVEIS REDESENHADA -->
      <div class="form-group">
        <label>Tamanhos DisponÃ­veis *</label>
        <div class="tamanhos-container">
          <div class="tamanhos-grid">
            <div *ngFor="let tamanho of tamanhosDisponiveis" class="tamanho-option">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [value]="tamanho"
                  (change)="onTamanhoChange($event)"
                  [checked]="tamanhosSelecionados.includes(tamanho)">
                <span class="checkmark"></span>
                {{ tamanho }}
              </label>
            </div>
          </div>
          <div *ngIf="tamanhos?.invalid && tamanhos?.touched" class="error-message">
            Selecione pelo menos um tamanho
          </div>
          <div class="tamanhos-selecionados" *ngIf="tamanhosSelecionados.length > 0">
            <strong>Tamanhos selecionados:</strong> {{ tamanhosSelecionados.join(', ') }}
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="marcaId">ID da Marca *</label>
          <input type="number" id="marcaId" formControlName="marcaId" min="1" class="form-control" 
                 placeholder="Use 1 para teste">
          <small class="form-text">Use 1 para teste se nÃ£o souber o ID</small>
          <div *ngIf="marcaId?.invalid && marcaId?.touched" class="error-message">
            ID da marca Ã© obrigatÃ³rio (nÃºmero maior que 0)
          </div>
        </div>

        <div class="form-group">
          <label for="modeloId">ID do Modelo *</label>
          <input type="number" id="modeloId" formControlName="modeloId" min="1" class="form-control" 
                 placeholder="Use 1 para teste">
          <div *ngIf="modeloId?.invalid && modeloId?.touched" class="error-message">
            ID do modelo Ã© obrigatÃ³rio
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="esporteId">ID do Esporte *</label>
          <input type="number" id="esporteId" formControlName="esporteId" min="1" class="form-control" 
                 placeholder="Use 1 para teste">
          <div *ngIf="esporteId?.invalid && esporteId?.touched" class="error-message">
            ID do esporte Ã© obrigatÃ³rio
          </div>
        </div>

        <div class="form-group">
          <label for="corId">ID da Cor *</label>
          <input type="number" id="corId" formControlName="corId" min="1" class="form-control" 
                 placeholder="Use 1 para teste">
          <div *ngIf="corId?.invalid && corId?.touched" class="error-message">
            ID da cor Ã© obrigatÃ³rio
          </div>
        </div>
      </div>

      <div class="form-group checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="ativo">
          <span class="checkmark"></span>
          Produto ativo
        </label>
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="tenisForm.invalid || isLoading" class="btn btn-primary">
          <svg *ngIf="isLoading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2v4m0 12v4m8-10h-4M8 12H4m13.657-5.657l-2.828 2.828m-9.9 9.9l-2.828 2.828m14.142 0l-2.828-2.828M6.343 6.343L3.515 3.515"/>
          </svg>
          <svg *ngIf="!isLoading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
            <polyline points="17 21 17 13 7 13 7 21"/>
            <polyline points="7 3 7 8 15 8"/>
          </svg>
          {{ isLoading ? 'Salvando...' : (editMode ? 'Atualizar TÃªnis' : 'Cadastrar TÃªnis') }}
        </button>
        
        <button *ngIf="editMode" type="button" (click)="cancelarEdicao()" class="btn btn-secondary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Cancelar EdiÃ§Ã£o
        </button>
      </div>
    </form>

    <!-- Mensagem de feedback redesenhada -->
    <div *ngIf="mensagem" class="message" [class.success]="!mensagem.includes('Erro')" [class.error]="mensagem.includes('Erro')">
      {{ mensagem }}
    </div>
  </div>

  <!-- Lista de TÃªnis Cadastrados redesenhada -->
  <div class="list-section">
    <h2>TÃªnis Cadastrados ({{ tenisList.length }})</h2>
    
    <div *ngIf="isLoading && tenisList.length === 0" class="loading">
      <p>Carregando tÃªnis...</p>
    </div>

    <div *ngIf="!isLoading && tenisList.length === 0" class="no-data">
      <p>Nenhum tÃªnis cadastrado.</p>
    </div>

    <div class="tenis-grid" *ngIf="tenisList.length > 0">
      <div *ngFor="let tenis of tenisList" class="tenis-card">
        <!-- IMAGENS DO TÃŠNIS -->
        <div class="tenis-images">
          <div *ngIf="tenis.imagensUrls && tenis.imagensUrls.length > 0" class="images-carousel">
            <img [src]="tenis.imagensUrls[0]" [alt]="tenis.nome" class="main-product-image">
            <div class="images-count" *ngIf="tenis.imagensUrls.length > 1">
              +{{ tenis.imagensUrls.length - 1 }}
            </div>
          </div>
          <div class="tenis-image placeholder" *ngIf="!tenis.imagensUrls || tenis.imagensUrls.length === 0">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            <span>Sem imagens</span>
          </div>
        </div>

        <div class="tenis-info">
          <h3>{{ tenis.nome }}</h3>
          <p class="descricao">{{ tenis.descricao }}</p>
          <div class="tenis-details">
            <span class="preco">{{ tenis.preco | currency:'BRL' }}</span>
            <span class="genero">{{ tenis.genero }}</span>
            <span class="status" [class.ativo]="tenis.ativo" [class.inativo]="!tenis.ativo">
              {{ tenis.ativo ? 'Ativo' : 'Inativo' }}
            </span>
          </div>
          <!-- EXIBIR TAMANHOS NA LISTA -->
          <div class="tamanhos-lista" *ngIf="tenis.tamanhos && tenis.tamanhos.length > 0">
            <strong>Tamanhos:</strong> {{ tenis.tamanhos.join(', ') }}
          </div>
          <!-- EXIBIR QUANTIDADE DE IMAGENS -->
          <div class="imagens-info" *ngIf="tenis.imagensUrls && tenis.imagensUrls.length > 0">
            <small><strong>Imagens:</strong> {{ tenis.imagensUrls.length }}</small>
          </div>
          <div class="ids-info">
            <small>Marca: {{ tenis.marcaId }} | Modelo: {{ tenis.modeloId }} | Esporte: {{ tenis.esporteId }} | Cor: {{ tenis.corId }}</small>
          </div>
        </div>
        <div class="tenis-actions">
          <button (click)="editarTenis(tenis)" class="btn-edit">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Editar
          </button>
          <button (click)="excluirTenis(tenis.id, tenis.nome)" class="btn-delete" [disabled]="!tenis.id">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            Excluir
          </button>
        </div>
      </div>
    </div>
  </div>
</div>